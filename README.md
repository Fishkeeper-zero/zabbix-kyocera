# zbx_kyocera_template_5.0
### Шаблоны для МФУ и принтеров Kyocera:
* Kyocera Ecosys M2040dn
* Kyocera Ecosys M2035dn
* Kyocera Ecosys P3060dn
* Kyocera Ecosys M3655idn
* Kyocera Ecosys FS4300dn
***
#### Группа узлов сети
* Создаем группы узлов сети по следующему критерию: группа по модели . В группу “по модели” добавляем устройства конкретной модели в независимости от местоположения.  Не забываем проставить тэги (по местоположению). Группа содержащая шаблоны только одна.
* Если ищем оборудование через “обнаружение > действие“, то обязательно добавляем в ручную созданные узлы в группу “Discovered hosts“
<table style="width: 572px; height: 263px;" data-number-column="false">
<tbody>
<tr style="height: 15px;">
<th class="ak-renderer-tableHeader-sortable-column" style="width: 213px; height: 15px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="434"><strong data-renderer-mark="true">Группа по модели</strong></p>
</div>
</th>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 174px; height: 15px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="454"><strong data-renderer-mark="true">Тэг местоположения</strong></p>
</div>
</th>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 163px; height: 15px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="476"><strong data-renderer-mark="true">Содержит шаблоны</strong></p>
</div>
</th>
</tr>
<tr style="height: 46px;">
<td style="width: 213px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="498">Kyocera Ecosys M3655idn</p>
</div>
</td>
<td style="text-align: center; width: 174px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="525">MSK</p>
</div>
</td>
<td style="width: 163px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="532">&nbsp;</p>
</div>
</td>
</tr>
<tr style="height: 46px;">
<td style="width: 213px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="538">Kyocera Ecosys M2040dn</p>
</div>
</td>
<td style="text-align: center; width: 174px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="564">NY</p>
</div>
</td>
<td style="width: 163px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p style="text-align: center;" data-renderer-start-pos="570">Да</p>
</div>
</td>
</tr>
<tr style="height: 46px;">
<td style="width: 213px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="576">Kyocera Ecosys M2035dn</p>
</div>
</td>
<td style="text-align: center; width: 174px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="602">Tai</p>
</div>
</td>
<td style="width: 163px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="609">&nbsp;</p>
</div>
</td>
</tr>
<tr style="height: 46px;">
<td style="width: 213px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="615">Kyocera Ecosys P3060dn</p>
</div>
</td>
<td style="width: 174px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="641">&nbsp;</p>
</div>
</td>
<td style="width: 163px; height: 46px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="645">&nbsp;</p>
</div>
</td>
</tr>
<tr style="height: 64px;">
<td style="width: 213px; height: 64px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="651">Kyocera Ecosys FS-4300DN</p>
</div>
</td>
<td style="width: 174px; height: 64px;" colspan="1" rowspan="1" data-colwidth="226.67">&nbsp;</td>
<td style="width: 163px; height: 64px;" colspan="1" rowspan="1" data-colwidth="226.67">&nbsp;</td>
</tr>
</tbody>
</table>

#### Шаблоны
* Группы элементов данных требуются для сортировки мониторинга. В данном случае данные для инвентаризации находятся в группе “Inventory“, а данные для активного мониторинга в группе “Monitoring“
*  Zabbix из коробки не поддерживает корректное чтение значений OID на русском языке. Для исправления данной проблемы необходимо в Статус принтера_дисплей > “элемент данных: ” > “предобработка“ > “JavaScript“ добавить скрипт из вложения ниже: 
```javascript
var preStr = ''; 
var preStrAr = value.split(" "); 
for (var j = 0; j < preStrAr.length; j++) { preStr += String.fromCharCode(parseInt(preStrAr[j], 16)); } 
var result = ""; 
var i = 0; 
var c = c1 = c2 = 0; while (i < preStr.length) { c = preStr.charCodeAt(i); 
if (c < 128) { result += String.fromCharCode(c); i++; } else if ((c > 191) && (c < 224)) { c2 = preStr.charCodeAt(i + 1); 
result += String.fromCharCode(((c & 31) << 6) | (c2 & 63)); i += 2; } 
else { c2 = preStr.charCodeAt(i + 1); 
c3 = preStr.charCodeAt(i + 2); 
result += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)); i += 3; } } return result;
```
* Элемент "Uptime" = "Предобработка" > "Пользовательский множитель". Значение = 0.01
* В элементах, которые имеют постоянные значения, необходимо в “Предобработка“ выбрать “Отбрасывать не изменившиеся“

<table style="width: 651px;" data-number-column="false">
<tbody>
<tr>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="1979"><strong data-renderer-mark="true"> Шаблон</strong></p>
</div>
</th>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="1990"><strong data-renderer-mark="true">Группа элементов данных</strong></p>
</div>
</th>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2017"><strong data-renderer-mark="true">Кол-во элементов</strong></p>
</div>
</th>
</tr>
<tr>
<td style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2039">Template_Kyocera_Common</p>
</div>
</td>
<td style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2066">Kyocera_Inventory_Common</p>
</div>
</td>
<td style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2094">9</p>
</div>
</td>
</tr>
<tr>
<td style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2101">&nbsp;</p>
</div>
</td>
<td style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2105">Kyocera_Monitoring_Common</p>
</div>
</td>
<td style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2134">6</p>
</div>
</td>
</tr>
<tr>
<td style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2141">Template_Kyocera_Print</p>
</div>
</td>
<td style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2167">Kyocera_Inventory_Print</p>
</div>
</td>
<td style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2194">&nbsp;</p>
</div>
</td>
</tr>
<tr>
<td style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2200">&nbsp;</p>
</div>
</td>
<td style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2204">Kyocera_Monitoring_Print</p>
</div>
</td>
<td style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2232">&nbsp;</p>
</div>
</td>
</tr>
<tr>
<td style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2238">Template_Kyocera_Scan</p>
</div>
</td>
<td style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2263">Kyocera_Inventory_Scan</p>
</div>
</td>
<td style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2289">&nbsp;</p>
</div>
</td>
</tr>
<tr>
<td style="width: 203px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2295">&nbsp;</p>
</div>
</td>
<td style="width: 237px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2299">Kyocera_Monitoring_Scan</p>
</div>
</td>
<td style="width: 189px;" colspan="1" rowspan="1" data-colwidth="226.67">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="2326">3</p>
</div>
</td>
</tr>
</tbody>
</table>

#### Тригеры
* Недоступность проверяется по элементу “Uptime“. Снимает показания раз в 60 сек.
* Проверки о неисправности идут через “kcprtAlertStateCod”
* Проверка на открытие передней крышки = код 44001, счетчик count считает, появилось ли данное значение 3 или более раз в течение 5 минут. Чтобы счетчик работал правильно необходимо второе условие. И вот почему: “Тут есть один нюанс, с которым вы, видимо, столкнулись. Условие триггера с count пересчитывается при поступлении нового значения. Ели ничего не прилетело, триггер не пересчитывается. Поэтому условие давно может быть ложным (нет трех 44001 за последние 5 минут), но об этом никто не узнает, если 37058 прилетело в те же 5 минут, когда три 44001 еще считались, а больше ничего не прилетало. Чтобы триггер пересчитывался каждые 30 сек, можно добавить в него через and какое-нибудь заведомо истинное условие с временной функцией, например ...and {Template_Kyocera_Common:kcprtAlertStateCod.now()} >0”

<table data-number-column="false">
<tbody>
<tr>
<th class="ak-renderer-tableHeader-sortable-column" colspan="1" rowspan="1" data-colwidth="287">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3305"><strong data-renderer-mark="true">Имя</strong></p>
</div>
</th>
<th class="ak-renderer-tableHeader-sortable-column" colspan="1" rowspan="1" data-colwidth="473">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3312"><strong data-renderer-mark="true">Выражение</strong></p>
</div>
</th>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="287">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3327">Устройство недоступно</p>
</div>
</td>
<td colspan="1" rowspan="1" data-colwidth="473">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3352">{Template_Kyocera_Common:uptime.device.nodata(30m)}=1</p>
</div>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="287">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3411">Замятие бумаги</p>
</div>
</td>
<td colspan="1" rowspan="1" data-colwidth="473">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3429">{Template_Kyocera_Common:kcprtAlertStateCod.last()}=42001</p>
</div>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="287">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3492">Открыта передняя крышка</p>
</div>
</td>
<td colspan="1" rowspan="1" data-colwidth="473">
<div class="fabric-editor-block-mark sc-ekulBa kTxOpQ" data-align="center">
<p data-renderer-start-pos="3519">{Template_Kyocera_Common:kcprtAlertStateCod.count(5m,44001)}&gt;=3<br />and<br />{Template_Kyocera_Common:kcprtAlertStateCod.now()}&gt;0</p>
</div>
</td>
</tr>
</tbody>
</table>

#### Обнаружение + Действие
*  Для того, что бы в сети найти МФУ или принтеры Kyocera необходимо через “Обнаружение“ создать условие, что искать и где. А через “Действие“ сообщить, что делать с найденным. Искать будем по OID картриджа

```javascript
.1.3.6.1.2.1.43.11.1.1.6.1.1  или .1.3.6.1.2.1.25.3.2.1.3.1
```
#### Преобразование значений

* Преобразование значений кодов на экране МФУ или принтера. Преобразование значений используется с элементом данных “Статус принтера_код”

<table style="width: 314px;" data-number-column="false">
<tbody>
<tr>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<div class="fabric-editor-block-mark sc-dfVpRl gOpNBi" data-align="center">
<p data-renderer-start-pos="4117"><strong data-renderer-mark="true">Код</strong></p>
</div>
</th>
<th class="ak-renderer-tableHeader-sortable-column" style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<div class="fabric-editor-block-mark sc-dfVpRl gOpNBi" data-align="center">
<p data-renderer-start-pos="4124"><strong data-renderer-mark="true">Значение</strong></p>
</div>
</th>
</tr>
<tr>
<td style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4138">10001</p>
</td>
<td style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4147">Готов к работе</p>
</td>
</tr>
<tr>
<td style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4167">35078</p>
</td>
<td style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4176">Режим ожидания</p>
</td>
</tr>
<tr>
<td style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4236">42001</p>
</td>
<td style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4245">Замятие</p>
</td>
</tr>
<tr>
<td style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4196">44001</p>
</td>
<td style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4205">Закройте переднюю крышку.</p>
</td>
</tr>
<tr>
<td style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4258">46101</p>
</td>
<td style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4267">Закончился тонер</p>
</td>
</tr>
<tr>
<td style="width: 64px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4289">46402</p>
</td>
<td style="width: 234px;" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4298">Неоригинальный картридж</p>
</td>
</tr>
</tbody>
</table>

#### Макросы 
<table data-number-column="false">
<tbody>
<tr>
<th class="ak-renderer-tableHeader-sortable-column" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4446"><strong data-renderer-mark="true">Макрос</strong></p>
</th>
<th class="ak-renderer-tableHeader-sortable-column" colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4456"><strong data-renderer-mark="true">Значение</strong></p>
</th>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4470">{$SNMPV3_AUTHPASS}</p>
</td>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4492">MD5/SHA1 (SHA1 - предпочтительнее)</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4532">{$SNMPV3_PORT}</p>
</td>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4550">161 (Standart snmp port)</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4580">{$SNMPV3_PRIVATEPASS}</p>
</td>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4605">AES/DES (AES - предпочтительнее)</p>
</td>
</tr>
<tr>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4643">{$SNMPV3_SECURITYNAME}</p>
</td>
<td colspan="1" rowspan="1" data-colwidth="340">
<p data-renderer-start-pos="4669">&nbsp;</p>
</td>
</tr>
</tbody>
</table>
